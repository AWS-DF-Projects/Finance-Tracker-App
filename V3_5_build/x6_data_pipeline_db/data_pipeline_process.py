from email.header import decode_header
import imaplib
import email
import pdfplumber
import re
import os
import pandas as pd


class DataPipelineProcess:
    def __init__(self):
        self.processed_text  = [
            "24 jan 25 ))) farmfoods 321 york 21.13",
            "25 jan 25 cr finch kl owed 40.00",
            "27 jan 25 vis intl 0051896991 tbl learn.cantril  amsterdam   19.20",
            "27 jan 25  non-sterling transaction fee 0.53",
            "27 jan 25 vis intl 0051896992 tbl learn.cantril  amsterdam   19.20",
            "27 jan 25  non-sterling transaction fee 0.53",
            "31 jan 25 cr vertu motors plc 2310.11",
            "31 jan 25 bp katie finch food 150.00",
            "02 feb 25 bp katie finch food 20.00",
            "02 feb 25 cr finch kl owed 10.00",
            "03 feb 25 dd forester life 51.77",
            "03 feb 25 dd dvla-yj70ulk 16.62",
            "03 feb 25 dd premfina-igo4 42.33",
            "03 feb 25 dd sky digital 51.00",
            "03 feb 25 dd tv licence mbp 15.00",
            "03 feb 25 so katie finch food 200.00",
            "03 feb 25 so katie finch bills 150.00",
            "03 feb 25 so katie finch rent 550.00",
            "03 feb 25 vis tesco pay at pump york 50.01",
            "03 feb 25 vis google youtube g.cohelppay# 12.99",
            "03 feb 25 vis bennett jones manchester 279.00",
            "03 feb 25 vis intl 0010214939 aws emea  aws.amazon.co 28.38",
            "05 feb 25 dd e.on next ltd 148.82",
            "07 feb 25 vis ring standard plan london 7.99",
            "07 feb 25 ))) simply chiropracti york 65.00",
            "07 feb 25 bp chloe amber finch car payment owed 250.00",
            "09 feb 25 bp katie finch food 20.00",
            "10 feb 25 dd practice plan 15.70",
            "10 feb 25 vis funky pigeon bristol 1.65",
            "14 feb 25 ))) tesco stores 5314 huntingdon 4.85",
            "16 feb 25 bp katie finch food 20.00",
            "17 feb 25 dd tesco mobile 109.97",
            "17 feb 25 ))) farmfoods 321 york 35.97",
            "19 feb 25 bp katie finch food 1.00",
            "19 feb 25 bp katie finch food 20.00",
            "23 dec 24 bp katie finch food and bil 40.00",
            "23 dec 24 cr finch kl owed 38.00",
            "23 dec 24 vis audible uk adbl.copymt 0.96",
            "23 dec 24 ))) farmfoods 321 york 48.70",
            "24 dec 24 ))) asda superstore huntington 38.03",
            "29 dec 24 cr c fawcett 20.00",
            "29 dec 24 bp katie finch mias day money 20.00",
            "31 dec 24 cr vertu motors plc 2454.07",
            "01 jan 25 bp chloe amber finch car payment 1.00",
            "01 jan 25 bp chloe amber finch car payment 249.00",
            "02 jan 25 dd forester life 50.00",
            "02 jan 25 dd dvla-yj70ulk 16.62",
            "02 jan 25 dd premfina-igo4 42.33",
            "02 jan 25 dd sky digital 51.00",
            "02 jan 25 dd tv licence mbp 15.00",
            "02 jan 25 dd city of york gener 161.00",
            "02 jan 25 so katie finch bills 150.00",
            "02 jan 25 so katie finch rent 550.00",
            "02 jan 25 vis google youtube g.cohelppay# 12.99",
            "02 jan 25 vis bennett jones manchester 279.00",
            "02 jan 25 bp katie finch food 91.00",
            "03 jan 25 so katie finch food 200.00",
            "03 jan 25 ))) simply chiropracti york 70.00",
            "03 jan 25 vis intl 0095141912 aws emea  aws.amazon.co 27.82",
            "06 jan 25 dd e.on next ltd 157.12",
            "07 jan 25 bp chloe amber finch car payment owed 100.00",
            "07 jan 25 vis ring standard plan london 7.99",
            "08 jan 25 dd practice plan 15.70",
            "09 jan 25 bp katie finch food 20.00",
            "09 jan 25 vis sainsburys smkts monks cross 30.02",
            "10 jan 25 vis intl 0040680696 cdkeys.com  internet 26.99",
            "15 jan 25 dd tesco mobile 109.97",
            "15 jan 25 atm cash bnkm jan15 asda york 1 30.00",
            "20 jan 25 ))) tesco stores 5314 huntingdon 3.90",
            "22 jan 25 bp katie finch food 50.00",
            "25 feb 25 vis funky pigeon bristol 4.32",
            "28 feb 25 cr vertu motors plc 2388.33",
            "28 feb 25 bp katie finch rent 570.00",
            "01 mar 25 bp katie finch rent 15.00",
            "02 mar 25 bp katie finch food 20.00",
            "03 mar 25 dd forester life 51.77",
            "03 mar 25 dd dvla-yj70ulk 16.62",
            "03 mar 25 dd premfina-igo4 42.33",
            "03 mar 25 dd sky digital 51.00",
            "03 mar 25 dd tv licence mbp 15.00",
            "03 mar 25 so katie finch food 200.00",
            "03 mar 25 so chloe amber finch car payment owed 250.00",
            "03 mar 25 so katie finch bills 150.00",
            "03 mar 25 vis google youtube g.cohelppay# 12.99",
            "03 mar 25 vis bennett jones manchester 279.00",
            "03 mar 25 vis intl 0016350219 aws emea  aws.amazon.co   0.35",
            "03 mar 25  non-sterling transaction fee 0.00",
            "05 mar 25 dd e.on next ltd 148.82",
            "07 mar 25 vis ring standard plan london 7.99",
            "07 mar 25 ))) simply chiropracti york 100.00",
            "10 mar 25 dd practice plan 15.70",
            "12 mar 25 atm cash notemac mar12 notemachine  40.00",
            "13 mar 25 vis sainsburys smkts monks cross 40.00",
            "15 mar 25 bp katie finch food 20.00",
            "16 mar 25 bp katie finch food 40.00",
            "17 mar 25 dd tesco mobile 110.52",
            "19 mar 25 atm cash rb scot mar19 tesco acomb  30.00",
            "20 mar 25 ))) farmfoods 321 york 47.93",
            "23 dec 23 bp katie finch internet 10.00",
            "29 dec 23 cr vertu motors plc 1989.80",
            "02 jan 24 dd dvla-yj70ulk 15.75",
            "02 jan 24 dd premfina-igo4 40.11",
            "02 jan 24 dd sky digital 41.00",
            "02 jan 24 dd city of york gener 154.00",
            "02 jan 24 so katie finch bills 130.00",
            "02 jan 24 so katie finch rent 500.00",
            "02 jan 24 vis google youtube g.cohelppay# 12.99",
            "03 jan 24 so katie finch food 100.00",
            "03 jan 24 vis sainsburys smkts monks cross 40.02",
            "04 jan 24 vis foss bank york york 3.50",
            "04 jan 24 atm cash notemac jan04 james hall  30.00",
            "05 jan 24 dd tv licence mbp first payment 31.80",
            "05 jan 24 dd e.on next 182.99",
            "05 jan 24 dd ford credit uk 359.51",
            "08 jan 24 dd forester life 100.00",
            "09 jan 24 bp katie finch food 15.00",
            "10 jan 24 vis google google pla g.cohelppay# 10.99",
            "12 jan 24 bp katie finch food 10.00",
            "15 jan 24 dd tesco mobile 94.97",
            "17 jan 24 ))) tesco stores 5314 huntingdon 0.65",
            "18 jan 24 ))) farmfoods 321 york 64.56",
            "18 jan 24 bp katie finch food 25.00",
            "19 jan 24 ))) tesco stores 5314 huntingdon 2.50",
            "20 jan 24 bp katie finch food 25.00",
            "22 jan 24 vis hpi instant ink uk www.hp.com 2.99",
            "22 jan 24 vis audible uk adbl.copymt 2.99",
            "22 jan 24 vis audible uk adbl.copymt 2.99",
            "25 jan 24 cr forester life 1571.65",
            "25 jan 24 cr finch kl owed 20.00",
            "25 jan 24 atm cash notemac jan25 james hall  30.00",
            "26 jan 24 cr finch kl owed 4800.00",
            "26 jan 24 cr chloe finch sent from monzo 1.00",
            "26 jan 24 cr chloe finch sent from monzo 4000.00",
            "31 jan 24 cr vertu motors plc 2283.15",
            "31 jan 24 bp katie finch food 20.00",
            "31 jan 24 vis ford credit europe basildon 10377.00",
            "31 jan 24 bp katie finch food 130.00",
            "01 feb 24 dd forester life first payment 50.00",
            "01 feb 24 dd dvla-yj70ulk 15.75",
            "01 feb 24 dd tv licence mbp 31.80",
            "01 feb 24 so katie finch bills 130.00",
            "01 feb 24 so katie finch rent 500.00",
            "01 feb 24 ))) york college york 1.00",
            "02 feb 24 dd premfina-igo4 40.11",
            "02 feb 24 dd sky digital 41.00",
            "02 feb 24 vis google youtube g.cohelppay# 12.99",
            "02 feb 24 vis bennett jones manchester 169.00",
            "02 feb 24 ))) tesco stores 5314 huntingdon 5.65",
            "04 feb 24 vis coinbase london 3.45",
            "05 feb 24 dd e.on next 182.99",
            "05 feb 24 so katie finch food 100.00",
            "06 feb 24 bp lyndsey cale couns counselling fee 30.00",
            "07 feb 24 bp katie finch food and bil 610.00",
            "11 feb 24 cr finch kl owed 50.00",
            "12 feb 24 vis sainsburys smkts monks cross 30.00",
            "12 feb 24 vis google google pla g.cohelppay# 10.99",
            "12 feb 24 ))) b & q 1232 york 4.99",
            "12 feb 24 ))) argos north walsha york 16.00",
            "12 feb 24 vis intl 0052697465 g2a.com  internet 2.59",
            "15 feb 24 dd tesco mobile 96.63",
            "18 feb 24 bp katie finch food and bil 60.00",
            "20 feb 24 vis hpi instant ink uk www.hp.com 2.99",
            "24 feb 24 bp chloe amber finch test 1.00",
            "29 feb 24 cr vertu motors plc 2374.27",
            "01 mar 24 dd forester life 50.00",
            "01 mar 24 dd dvla-yj70ulk 15.75",
            "01 mar 24 dd tv licence mbp 31.80",
            "01 mar 24 so katie finch bills 150.00",
            "01 mar 24 so katie finch rent 550.00",
            "04 mar 24 dd premfina-igo4 40.11",
            "04 mar 24 dd sky digital 41.00",
            "04 mar 24 so katie finch food 200.00",
            "04 mar 24 vis google youtube g.cohelppay# 12.99",
            "04 mar 24 vis bennett jones manchester 169.00",
            "04 mar 24 ))) sainsburys petrol monks cross 50.00",
            "05 mar 24 dd e.on next 182.99",
            "05 mar 24 so chloe amber finch car loan payment 250.00",
            "06 mar 24 atm cash rb scot mar06 tesco york e 30.00",
            "07 mar 24 ))) sainsburys smkts monks cross 3.00",
            "09 mar 24 bp katie finch food and bil 10.00",
            "11 mar 24 cr ebay commerce uk l p6262388767 6.20",
            "11 mar 24 vis google google pla g.cohelppay# 10.99",
            "12 mar 24 vis ebay c 22-11257-89 london 6.20",
            "14 mar 24 ))) tesco stores 5314 huntingdon 7.50",
            "15 mar 24 dd tesco mobile 96.07",
            "15 mar 24 ))) simply chiropracti york 70.00",
            "15 mar 24 bp katie finch food and bil 20.00",
            "16 mar 24 bp katie finch food and bil 25.00",
            "18 mar 24 vis tesco stores 3480 york 2 164.94",
            "18 mar 24 ))) farmfoods 321 york 2.54",
            "18 mar 24 bp katie finch food and bil 10.00",
            "19 mar 24 vis intl 0021028663 bb-samsung  schwalbach 2.00",
            "19 mar 24 vis intl 0021028662 bb-samsung  schwalbach 0.78",
            "20 mar 24 vis hpi instant ink uk www.hp.com 3.99",
            "21 mar 24 ))) farmfoods 321 york 10.06",
            "21 mar 24 ))) b & q 1232 york 1.55",
            "21 mar 24 ))) the range york 5.00",
            "21 mar 24 atm cash notemac mar21 notemachine  30.00",
            "21 mar 24 bp katie finch food and bil 80.00",
            "23 mar 24 bp katie finch food and bil 6.00",
            "25 mar 24 vis audible uk adbl.copymt 0.99",
            "25 mar 24 vis audible uk adbl.copymt 0.99",
            "25 mar 24 ))) asda superstore huntington 5.62",
            "25 mar 24 ))) b & q 1232 york 17.00",
            "27 mar 24 ))) farmfoods 321 york 38.87",
            "27 mar 24 vis intl 0078064112 udemy  +905326253880 17.99",
            "28 mar 24 cr vertu motors plc 2331.43",
            "28 mar 24 bp katie finch food and bil 50.00",
            "02 apr 24 dd forester life 50.00",
            "02 apr 24 dd dvla-yj70ulk 15.75",
            "02 apr 24 dd premfina-igo4 40.11",
            "02 apr 24 dd sky digital 45.50",
            "02 apr 24 dd tv licence mbp 31.80",
            "02 apr 24 dd city of york gener 159.40",
            "02 apr 24 so katie finch bills 150.00",
            "02 apr 24 so katie finch rent 550.00",
            "02 apr 24 vis google youtube g.cohelppay# 12.99",
            "02 apr 24 vis bennett jones manchester 279.00",
            "02 apr 24 vis sainsburys smkts monks cross 50.03",
            "02 apr 24 ))) the range york 1.59",
            "02 apr 24 vis microsoftxbox msbill.info 12.99",
            "03 apr 24 so katie finch food 200.00",
            "05 apr 24 dd e.on next ltd first payment 162.45",
            "05 apr 24 so chloe amber finch car loan payment 250.00",
            "08 apr 24 vis intl 0052056981 monokai  amsterdam  eur 12.50 @",
            "08 apr 24  non-sterling transaction fee 0.29",
            "10 apr 24 vis google google pla g.cohelppay# 10.99",
            "12 apr 24 ))) simply chiropracti york 70.00",
            "15 apr 24 dd tesco mobile 109.97",
            "15 apr 24 vis wisepay 01905759613 1.65",
            "15 apr 24 ))) sainsburys petrol monks cross 8.11",
            "18 apr 24 vis wisepay 01905759613 1.65",
            "18 apr 24 atm cash notemac apr18 notemachine  30.00",
            "22 apr 24 vis hpi instant ink uk www.hp.com 3.99",
            "23 apr 24 cr finch kl owed 55.00",
            "24 apr 24 ))) farmfoods 321 york 9.46",
            "25 apr 24 vis google google pla g.cohelppay# 12.99",
            "25 apr 24 vis google google pla g.cohelppay# 12.99",
            "25 apr 24 ))) tesco stores 5314 huntingdon 7.25",
            "30 apr 24 cr vertu motors plc 2462.62",
            "01 may 24 dd forester life 50.00",
            "01 may 24 dd dvla-yj70ulk 15.75",
            "01 may 24 dd tv licence mbp 31.80",
            "01 may 24 dd city of york gener 161.00",
            "01 may 24 so katie finch bills 150.00",
            "01 may 24 so katie finch rent 550.00",
            "01 may 24 bp lyndsey cale couns counselling fee 30.00",
            "02 may 24 dd premfina-igo4 40.11",
            "02 may 24 dd sky digital 45.50",
            "02 may 24 vis google youtube g.cohelppay# 12.99",
            "02 may 24 vis bennett jones manchester 279.00",
            "02 may 24 ))) york dental practi york 100.00",
            "02 may 24 ))) tesco stores 5314 huntingdon 2.45",
            "03 may 24 so katie finch food 200.00",
            "03 may 24 vis sainsburys smkts monks cross 50.02",
            "07 may 24 dd e.on next ltd 162.45",
            "07 may 24 so chloe amber finch car loan payment 250.00",
            "09 may 24 vis york dental practi york 65.00",
            "09 may 24 ))) york dental practi york 36.00",
            "10 may 24 vis google google pla g.cohelppay# 10.99",
            "15 may 24 dd tesco mobile 112.17",
            "16 may 24 vis google google pla g.cohelppay# 11.99",
            "16 may 24 vis google google pla g.cohelppay# 11.99",
            "18 may 24 bp katie finch food and bil 40.00",
            "20 may 24 vis hpi instant ink uk www.hp.com 3.99",
            "26 may 24 bp katie finch food and bil 20.00",
            "27 may 24 bp katie finch food and bil 25.00",
            "28 may 24 ))) taco bell - monks york 18.37",
            "28 may 24 vis microsoftxbox msbill.info 1.00",
            "31 may 24 cr vertu motors plc 2440.68",
            "03 jun 24 dd forester life 50.00",
            "03 jun 24 dd dvla-yj70ulk 15.75",
            "03 jun 24 dd premfina-igo4 40.11",
            "03 jun 24 dd sky digital 45.50",
            "03 jun 24 dd tv licence mbp 13.25",
            "03 jun 24 dd city of york gener 161.00",
            "03 jun 24 so katie finch food 200.00",
            "03 jun 24 so katie finch bills 150.00",
            "03 jun 24 so katie finch rent 550.00",
            "03 jun 24 vis google youtube g.cohelppay# 12.99",
            "03 jun 24 vis bennett jones manchester 279.00",
            "03 jun 24 ))) farmfoods 321 york 55.15",
            "05 jun 24 dd e.on next ltd 162.45",
            "05 jun 24 so chloe amber finch car loan payment 250.00",
            "06 jun 24 vis york dental practi york 68.00",
            "06 jun 24 ))) tesco stores 5314 huntingdon 3.75",
            "06 jun 24 atm cash notemac jun06 notemachine  40.00",
            "10 jun 24 dd practice plan first payment 25.20",
            "10 jun 24 vis google google pla g.cohelppay# 10.99",
            "12 jun 24 cr finch kl owed 10.00",
            "12 jun 24 atm cash notemac jun12 notemachine  20.00",
            "17 jun 24 dd tesco mobile 109.97",
            "17 jun 24 vis sainsburys smkts monks cross 30.00",
            "17 jun 24 vis microsoftxbox msbill.info 12.99",
            "17 jun 24 vis intl 0082192365 apple.combill  apple.combil 8.99",
            "19 jun 24 vis hpi instant ink uk www.hp.com 3.99",
            "22 jun 24 bp katie finch food and bil 10.00",
            "25 jul 24 atm cash notemac jul25 notemachine  30.00",
            "25 jul 24 cr finch kl owed 35.00",
            "26 jul 24 ))) simply chiropracti york 70.00",
            "28 jul 24 atm cash notemac jul28 notemachine  10.00",
            "31 jul 24 cr vertu motors plc 2462.29",
            "31 jul 24 ))) asda stores york 49.12",
            "01 aug 24 dd forester life 50.00",
            "01 aug 24 dd dvla-yj70ulk 15.75",
            "01 aug 24 dd tv licence mbp 13.25",
            "01 aug 24 dd city of york gener 161.00",
            "01 aug 24 so katie finch bills 150.00",
            "01 aug 24 so katie finch rent 550.00",
            "01 aug 24 vis intl 0026599148 udemy  +905326253880 14.99",
            "02 aug 24 dd premfina-igo4 40.11",
            "02 aug 24 dd sky digital 45.76",
            "02 aug 24 vis google youtube g.cohelppay# 12.99",
            "02 aug 24 vis bennett jones manchester 279.00",
            "05 aug 24 dd e.on next ltd 116.07",
            "05 aug 24 so katie finch food 200.00",
            "05 aug 24 so chloe amber finch car loan payment 250.00",
            "05 aug 24 vis sainsburys smkts monks cross 60.00",
            "06 aug 24 vis google google pla g.cohelppay# 0.99",
            "06 aug 24 ))) farmfoods 321 york 15.99",
            "07 aug 24 vis google google pla g.cohelppay# 14.99",
            "08 aug 24 dd practice plan 15.70",
            "08 aug 24 ))) york dental practi york 68.00",
            "08 aug 24 ))) farmfoods 321 york 7.29",
            "08 aug 24 atm cash notemac aug08 notemachine  10.00",
            "15 aug 24 dd tesco mobile 116.54",
            "15 aug 24 ))) york vets4pets handforth 29.63",
            "20 aug 24 bp katie finch food and bil 80.00",
            "20 aug 24 vis hpi instant ink uk www.hp.com 1.49",
            "21 aug 24 vis google google pla g.cohelppay# 12.99",
            "27 aug 24 ))) tesco stores 5314 huntingdon 2.65",
            "27 aug 24 ))) the range york 28.13",
            "27 aug 24 vis intl 0095911310 udemy  +905326253880 11.99",
            "28 aug 24 ))) north yorkshire co scarborough 3.60",
            "28 aug 24 ))) sainsburys petrol monks cross 25.01",
            "29 aug 24 bp katie finch food and bil 20.00",
            "30 aug 24 cr vertu motors plc 2388.30",
            "30 aug 24 ))) simply chiropracti york 70.00",
            "31 aug 24 bp katie finch food and bil 50.00",
            "01 sep 24 cr chloe finch sent from monzo 1.00",
            "01 sep 24 cr chloe finch sent from monzo 29.00",
            "02 sep 24 dd forester life 50.00",
            "02 sep 24 dd dvla-yj70ulk 15.75",
            "02 sep 24 dd premfina-igo4 40.11",
            "02 sep 24 dd sky digital 46.50",
            "02 sep 24 dd tv licence mbp 13.25",
            "02 sep 24 dd city of york gener 161.00",
            "02 sep 24 so katie finch bills 150.00",
            "02 sep 24 so katie finch rent 550.00",
            "02 sep 24 vis google youtube g.cohelppay# 12.99",
            "02 sep 24 vis bennett jones manchester 279.00",
            "02 sep 24 vis playstation networ london 54.99",
            "03 sep 24 so katie finch food 200.00",
            "03 sep 24 vis intl 0071439186 aws emea  aws.amazon.co 10.25",
            "05 sep 24 dd e.on next ltd 116.07",
            "05 sep 24 so chloe amber finch car loan payment 250.00",
            "05 sep 24 ))) b&m 632 - york york 12.00",
            "09 sep 24 dd practice plan 15.70",
            "09 sep 24 ))) sainsburys petrol monks cross 30.01",
            "10 sep 24 cr finch kl owed 70.00",
            "10 sep 24 bp katie finch food and bil 70.00",
            "11 sep 24 ))) york bmw mini sele york 29.65",
            "16 sep 24 dd tesco mobile 110.52",
            "16 sep 24 ))) farmfoods 321 york 3.44",
            "20 sep 24 vis hpi instant ink uk www.hp.com 2.49",
            "20 sep 24 ))) tesco stores 5314 huntingdon 10.05",
            "23 sep 24 ))) taco bell - monks york 17.18",
            "23 sep 24 ))) tesco stores 5314 huntingdon 9.80",
            "24 sep 24 bp tool mix ltd tools 10.00",
            "30 sep 24 cr vertu motors plc 2462.62",
            "30 sep 24 ))) farmfoods 321 york 52.44",
            "01 oct 24 dd forester life 50.00",
            "01 oct 24 dd dvla-yj70ulk 15.75",
            "01 oct 24 dd tv licence mbp 13.25",
            "01 oct 24 dd city of york gener 161.00",
            "01 oct 24 so katie finch bills 150.00",
            "01 oct 24 so katie finch rent 550.00",
            "01 oct 24 cr vertu motors plc payroll 235.00",
            "02 oct 24 dd premfina-igo4 40.11",
            "02 oct 24 dd sky digital 46.50",
            "02 oct 24 bp katie finch food and bil 30.00",
            "02 oct 24 vis bennett jones manchester 279.00",
            "03 oct 24 so katie finch food 200.00",
            "03 oct 24 bp katie finch food and bil 300.00",
            "03 oct 24 vis google youtube london 12.99",
            "03 oct 24 vis sainsburys smkts monks cross 59.00",
            "03 oct 24 ))) asda superstore huntington 23.78",
            "03 oct 24 vis intl 0093267280 aws emea  aws.amazon.co 26.59",
            "04 oct 24 ))) simply chiropracti york 70.00",
            "05 oct 24 cr chloe finch sent from monzo 30.00",
            "07 oct 24 dd e.on next ltd 157.12",
            "07 oct 24 so chloe amber finch car loan payment 250.00",
            "07 oct 24 ))) farmfoods 321 york 3.49",
            "08 oct 24 dd practice plan 15.70",
            "08 oct 24 vis intl 0031990245 aws emea  aws.amazon.co 26.59",
            "08 oct 24 bp katie finch food and bil 20.00",
            "10 oct 24 ))) stoneacre york york 146.86",
            "15 oct 24 dd tesco mobile 109.97",
            "15 oct 24 vis google google pla g.cohelppay# 12.99",
            "17 oct 24 bp katie finch food and bil 40.00",
            "21 oct 24 vis hpi instant ink uk www.hp.com 1.49",
            "23 oct 24 ))) tesco stores 5314 huntingdon 3.95",
            "23 oct 24 ))) cp plus ltd clifton 3.10",
            "23 oct 24 atm cash notemac oct23 notemachine  40.00",
            "26 oct 24 bp katie finch food and bil 9.00",
            "26 oct 24 bp katie finch food and bil 10.00",
            "28 oct 24 bp katie finch food and bil 10.00",
            "30 oct 24 bp katie finch food and bil 10.00",
            "31 oct 24 cr vertu motors plc 2830.72",
            "31 oct 24 atm cash notemac oct31 notemachine  30.00",
            "31 oct 24 bp katie finch food and bil 500.00",
            "01 nov 24 dd forester life 50.00",
            "01 nov 24 dd tv licence mbp 13.25",
            "01 nov 24 dd city of york gener 161.00",
            "01 nov 24 so katie finch bills 150.00",
            "01 nov 24 so katie finch rent 550.00",
            "01 nov 24 ))) simply chiropracti york 70.00",
            "04 nov 24 dd sky digital 46.50",
            "04 nov 24 so katie finch food 200.00",
            "04 nov 24 vis google youtube g.cohelppay# 12.99",
            "04 nov 24 vis bennett jones manchester 279.00",
            "04 nov 24 ))) york bmw mini sele york 87.43",
            "04 nov 24 vis intl 0029581107 aws emea  aws.amazon.co 26.95",
            "05 nov 24 dd e.on next ltd 157.12",
            "05 nov 24 dd premfina-igo4 42.40",
            "05 nov 24 so chloe amber finch car loan payment 250.00",
            "05 nov 24 cr finch kl owed 50.00",
            "07 nov 24 vis ring standard plan london 7.99",
            "08 nov 24 dd practice plan 15.70",
            "14 nov 24 dd dvla-yj70ulk 16.68",
            "14 nov 24 ))) boroughbridge road york 30.00",
            "15 nov 24 dd tesco mobile 112.17",
            "19 nov 24 vis hpi instant ink uk www.hp.com 1.49",
            "20 nov 24 atm cash notemac nov20 notemachine  40.00",
            "24 mar 25 vis audible uk adbl.copymt 0.99",
            "27 mar 25 vis funky pigeon bristol 7.29",
            "27 mar 25 ))) taco bell - monks york 19.37",
            "27 mar 25 ))) simply chiropracti york 35.00",
            "31 mar 25 cr vertu motors plc 2389.95",
            "31 mar 25 bp katie finch food 570.00",
            "31 mar 25 vis google youtube london 3.49",
            "31 mar 25 ))) tesco stores 5314 huntingdon 4.00",
            "01 apr 25 dd forester life 51.77",
            "01 apr 25 dd dvla-yj70ulk 16.62",
            "01 apr 25 dd tv licence mbp 15.00",
            "01 apr 25 dd city of york gener 173.69",
            "01 apr 25 so katie finch bills 150.00",
            "01 apr 25 bp katie finch standing order 200.00",
            "02 apr 25 dd premfina-igo4 42.33",
            "02 apr 25 dd sky digital 57.60",
            "02 apr 25 bp katie finch food 20.00",
            "02 apr 25 vis google youtube london 12.99",
            "02 apr 25 vis bennett jones manchester 279.00",
            "02 apr 25 atm cash ycsh apr02 88 dobworth  30.00",
            "03 apr 25 so chloe amber finch car payment owed 250.00",
            "04 apr 25 ))) tesco stores 5314 huntingdon 6.75",
            "07 apr 25 dd e.on next ltd 148.82",
            "07 apr 25 vis sainsburys smkts monks cross 50.00",
            "07 apr 25 vis ring standard plan london 7.99",
            "07 apr 25 ))) decathlon york york 25.97",
            "08 apr 25 dd practice plan 16.96",
            "09 apr 25 bp katie finch food 5.00",
            "10 apr 25 ))) farmfoods 321 york 51.65",
            "11 apr 25 ))) simply chiropracti york 109.00",
            "12 apr 25 bp katie finch food 9.00",
            "15 apr 25 dd tesco mobile 109.97",
            "19 apr 25 cr dobinson ao . 5.00",
            "22 apr 25 vis google youtube london 2.49",

        ]
        #   --------------------------------   Patterns    --------------------------------
        self.start_pattern = r"balancebroughtforward"      # Match 'balancebroughtforward' followed by any number (with or without decimals)
        self.end_pattern   = r"balancecarriedforward"      # Match 'balancecarriedforward' as the end marker
        self.bal_pattern   = r"\d{1,3}(?:,\d{3})*\.\d{2}"  # Match '23.45 1,345.00' for delete of [1] for balance
        self.rate_pattern  = r'visa\s*rate\s*\d+\.\d{2}'   # Match '@   visa rate 19.46' for delete of [1] for balance
        self.usd_pattern   = r"usd\s+\d+\.\d{2}"
        self.float_pattern = r"\d+\.\d{2}$"
        self.time_pattern  = r"@\d{2}\:\d{2}"
        self.date_pattern  = r"(\d{2} \w{3} \d{2})"
        self.tran_pattern  = r"(\)\)\))|dd|so|vis|atm|cr|bp"
        self.desc_pattern  = r"^\d{2} \w{3} \d{2} \s*(dd|so|vis|atm|cr|bp|\)\)\))\s*"  # to strip
        self.cost_pattern  = r"(\d{1,3}(?:,\d{3})*(?:\.\d{2})|\d+\.\d{2})\s*$"

        self.df: pd.DataFrame | None = None

# ---------------------------------------   Clean Text  --------------------------------------
    def to_dataframe(self):
        df = pd.DataFrame(self.processed_text, columns=['raw_data'])
        pd.set_option('display.max_rows', None)

        df['date'] = df['raw_data'].apply(
            lambda x: re.match(self.date_pattern, x).group(1) if re.match(self.date_pattern, x) else None)
        df['tran'] = df['raw_data'].apply(
            lambda x: re.search(self.tran_pattern, x).group(0) if re.search(self.tran_pattern, x) else None)
        df['cost'] = df['raw_data'].apply(
            lambda x: re.search(self.cost_pattern, x).group(1) if re.search(self.cost_pattern, x) else None)
        df['cost'] = pd.to_numeric(df['cost'], errors='coerce')
        df['description'] = df['raw_data'].apply(lambda x: re.sub(
            self.date_pattern, "",
            re.sub(self.tran_pattern, "",
            re.sub(self.cost_pattern,"", x))).strip())

        self.df = df[['date', 'tran', 'description', 'cost']]
        return self.df

    def split_to_sections(self):
        df = self.df
        direct_debit = df[df['tran'].isin(["dd", "so"])]
        mth_wage     = df[df['description'].str.contains('vertu', case=False, na=False)]
        credit       = df[df['tran'].isin(['cr']) & ~df['description'].str.contains('vertu', case=False, na=False)]
        expense      = df[
            ~df.index.isin(direct_debit.index) &
            ~df.index.isin(credit.index) &
            ~df.index.isin(mth_wage.index)]

        print("-" * 65)
        print("Dirct Debits")
        print("-" * 65)
        dd_df = pd.DataFrame(direct_debit, columns=['date', 'tran', 'description', 'cost'])
        print(dd_df)
        print("-" * 65)
        print("Wages")
        print("-" * 65)
        wg_df = pd.DataFrame(mth_wage, columns=['date', 'tran', 'description', 'cost'])
        print(wg_df)
        print("-" * 65)
        print("Credit")
        print("-" * 65)
        cr_df = pd.DataFrame(credit, columns=['date', 'tran', 'description', 'cost'])
        print(cr_df)
        print("-" * 65)
        print("Expenses")
        print("-" * 65)
        ex_df = pd.DataFrame(expense, columns=['date', 'tran', 'description', 'cost'])
        print(ex_df)


        return direct_debit, mth_wage, expense, credit



# --------------------------------------------------------------------------------------------------------------
# ---------------------------------------------  Run the Pipeline ----------------------------------------------

dpl_pro = DataPipelineProcess()

def run_data_pipeline_process():
#            |                                                 |
#            |                                                 |
#            v                                                 v
    dpl_pro.to_dataframe()
    print("\nHere's the lines extracted...\n")#              Print
    dpl_pro.split_to_sections()
    print("\nProcessing complete.\n")#                     Print End

run_data_pipeline_process()

